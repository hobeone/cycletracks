{% extends "base.html" %}
{% load extra_filters %}

{% block title %}CycleTracks Dashboard{% endblock %}

{% block extra_head %}
<script type="text/javascript">
  function delete_activity(id) {
    if (confirm('Are you sure?'))
    {
    $.ajax({
        url: '/activity/delete/',
        type: 'POST',
        timeout: 4000,
        data: {'activity_id':id},
        error: function(XMLHttpRequest, textStatus, errorThrown) {
          alert('Error Deleting Activity ' + id +': ' + textStatus)
        },
        success: function(response){
          $('#activity_'+id).fadeOut(500)
        }
    });
    }
  };
</script>
{% endblock %}

{% block content %}
<div id="activity_table">
  <div id="userSummaryDataComponent" class="activityComponent">
    <div id="summaryTitle">Summary for {{user.username}}:</div>
    <div id="userSummaryContent">
      <div id="summaryTotalDistance">
        <span class="summaryLabel">Total Distance:</span>
        <span class="summaryField">{{ user_totals.total_meters|meters_to_prefered_distance:user.get_profile.use_imperial }} {{user.get_profile.use_imperial|miles_or_km_units}}</span>
      </div>
      <div id="summaryTotalClimbing">
        <span class="summaryLabel">Total Climbing:</span>
        <span class="summaryField">{{ user_totals.total_ascent|meters_to_prefered_distance:user.get_profile.use_imperial }} {{user.get_profile.use_imperial|miles_or_km_units}}</span>
      </div>
      <div id="summaryTotalTime">
        <span class="summaryLabel">Total Time:</span>
        <span class="summaryField">{{ user_totals.total_time|seconds_to_human_readable }}</span>
      </div>
      <div id="summaryRollingTime">
        <span class="summaryLabel">Rolling Time:</span>
        <span class="summaryField">{{ user_totals.rolling_time|seconds_to_human_readable }}</span>
      </div>
      <div id="summaryCadence">
        <span class="summaryLabel">Cadence:</span>
        <span class="summaryField">{{ user_totals.average_cadence|floatformat:"-2" }} / {{ user_totals.maximum_cadence|floatformat:"-2" }} rpm</span>
      </div>
      <div id="summaryHeartRate">
        <span class="summaryLabel">Heart Rate:</span>
        <span class="summaryField">{{ user_totals.average_bpm|floatformat:"-2" }} / {{ user_totals.maximum_bpm|floatformat:"-2" }} bpm</span>
      </div>
      <div id="summaryAverageSpeed">
        <span class="summaryLabel">Average Speed:</span>
        <span class="summaryField">{{ user_totals.average_speed|kph_to_prefered_speed:user.get_profile.use_imperial }} {{user.get_profile.use_imperial|mph_or_kph_units}}</span>
      </div>
      <div id="summaryMaxSpeed">
        <span class="summaryLabel">Max Speed:</span>
        <span class="summaryField">{{ user_totals.maximum_speed|kph_to_prefered_speed:user.get_profile.use_imperial }} {{user.get_profile.use_imperial|mph_or_kph_units}}</span>
      </div>
      <div id="summaryCalories">
        <span class="summaryLabel">Calories:</span>
        <span class="summaryField">{{ user_totals.total_calories|floatformat:"-2" }} Cal</span>
      </div>
    </div>
  </div>
</div>

<br/><br/>
<h2>{{user.username}}'s tracks:</h2>
<div class="datatable">
<table cellspacing="2" width="100%">
  <thead>
  <tr>
    <th><a href='/mytracks/name'>Activity Name</a></th>
    <th><a href='/mytracks/start_time'>Start Time</a></th>
    <th><a href='/mytracks/total_meters'>Distance</a></th>
    <th><a href='/mytracks/rolling_time'>Time<br/>(Rolling)</a></th>
    <th><a href='/mytracks/average_cadence'>Avg/Max Cadence</a></th>
    <th><a href='/mytracks/average_bpm'>Avg/Max BPM</a></th>
    <th><a href='/mytracks/average_speed'>Avg/Max Speed</a></th>
    <th><a href='/mytracks/total_ascent'>Ascent/Decent</a></th>
    <th><a href='/mytracks/total_calories'>Calories</a></th>
    <th>Delete</th>
  </tr>
</thead>
<tbody>
  {% ifnotequal num_activities 0 %}
    {% for entry in user_activities %}
    <tr id="activity_{{entry.key}}">
      <td><a href="/activity/show/{{ entry.key }}">{{ entry.name }}</a></td>
      <td>{{ entry.start_time|time_to_offset:user.get_profile.tzoffset|date:"n/j/y-H:i" }}</td>
      <td>{{ entry.total_meters|meters_to_prefered_distance:user.get_profile.use_imperial}}</td>
      <td>{{ entry.total_time|seconds_to_human_readable }}
        <br/>
        ({{ entry.rolling_time|seconds_to_human_readable }})
      </td>
      <td>{{ entry.average_cadence|floatformat:"-2" }} rpm<br/> {{ entry.maximum_cadence|floatformat:"-2" }} rpm</td>
      <td>{{ entry.average_bpm|floatformat:"-2" }} bpm<br/> {{ entry.maximum_bpm|floatformat:"-2" }} bpm</td>
      <td>{{ entry.average_speed|kph_to_prefered_speed:user.get_profile.use_imperial }} <br/> {{ entry.maximum_speed|kph_to_prefered_speed:user.get_profile.use_imperial }}</td>
      <td>{{ entry.total_ascent|format_meters:user.get_profile.use_imperial }} <br/> {{entry.total_descent|format_meters:user.get_profile.use_imperial}}</td>
      <td>{{ entry.total_calories|floatformat:"-2" }} Cal</td>
      <td onclick="delete_activity('{{ entry.key }}')">delete</td>
    </tr>
    {% endfor %}
  {% else %}
    <tr>
      <td colspan="11">
        <p>You haven't uploaded any activities.  Click the upload link to get started.</p>
      </td>
    </tr>
    {% endifnotequal %}
  </tbody>
</table>
</div>
{% endblock %}
